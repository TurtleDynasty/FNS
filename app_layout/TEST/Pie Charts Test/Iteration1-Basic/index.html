<!DOCTYPE html>
<meta charset="utf-8">
<style>

	.arc text
	{
		font: 10px sans-serif;
		text-anchor: middle;
	}

	.arc path
	{
		stroke: #fff;
	}

</style>
<body>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script>
		var url = "http://localhost/";
		var margin = {top: 50, right: 50, bottom: 50, left: 50};
		var width = 1000 - margin.left - margin.right;
		var height = 900 - margin.top - margin.bottom;
		var innerRadius = 5;
		var outerRadius = 200;

		var pieSegmentPullOut = 15;
		var piePullOutDuration = 500;

		var color = d3.scaleOrdinal()
			.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

		var arc = d3.arc()
			.innerRadius(innerRadius)
			.outerRadius(outerRadius);
		var arcOver = d3.arc()
			.innerRadius(innerRadius)
			.outerRadius(outerRadius + pieSegmentPullOut);
		var labelArc = d3.arc()
			.innerRadius(outerRadius - 40)
			.outerRadius(outerRadius - 40);

		var pie = d3.pie()
			.sort(null)
			.value(function(d)
			{
				return d.count;
			});

		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height)
			.append("g")
			.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

		function type(d)
		{
			d.count = +d.count;
			return d;
		}
		d3.csv("data.csv", type, function(error, data)
		{
			if (error)
			{
				throw error;
			}
			data = parseData(data);
			g = svg.selectAll(".arc")
				.data(pie(data))
				.enter().append("g")
				.attr("class", "arc");

			addPieSegements();
			addPieLabels();

		});
		function addPieSegements()
		{
			g.append("path")
				.attr("d", arc)
				.style("fill", function(d)
				{
					return color(d.data.name);
				})
				.on("mouseenter", function(d)
				{
					d3.select(this)
						.transition()
						.duration(piePullOutDuration)
						.attr("d", arcOver);
				})
				.on("mouseout", function(d)
				{
					d3.select(this)
						.transition()
						.duration(piePullOutDuration)
						.attr("d", arc);
				});
		}
		function addPieLabels()
		{
			g.append("text")
				.attr("transform", function(d)
				{
					return "translate(" + labelArc.centroid(d) + ")";
				})
				.attr("dy", ".35em")
				.style("font-size", "14px")
				.text(function(d)
				{
					return d.data.name;
				});
		}
		function parseData(data)
		{
			var stripped = convertToArray(data);
			var compressed = compressArray(stripped);
			var parsedData = customFilterData(compressed);
			return parsedData;

		}
		function convertToArray(original)
		{
			var result = [];
			for(i = 0; i < original.length; i++)
			{
				result.push(original[i].name);
			}
			return result;
		}
		function compressArray(original)
		{

			var compressed = [];
			// make a copy of the input array
			var copy = original.slice(0);

			// first loop goes over every element
			for (var i = 0; i < original.length; i++)
			{
				var myCount = 0;
				// loop over every element in the copy and see if it's the same

				for (var w = 0; w < copy.length; w++)
				{
					if (original[i] == copy[w])
					{
						// increase amount of times duplicate is found
						myCount++;
						// sets item to undefined
						delete copy[w];
					}
				}

				if (myCount > 0)
				{
					var a = new Object();
					a.name = original[i];
					a.count = myCount;
					compressed.push(a);
				}
			}
			return compressed;
		}
		function customFilterData(data)
		{
			// Custom data filters go here.
			var copy = []
			for(i = 0; i < data.length; i++)
			{
				// Filter goes here. console.log(data[i]) to know the poperties of said data
				copy.push(data[i]);
			}
			return copy;
		}
	</script>
