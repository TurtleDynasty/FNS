<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
	font: 10px sans-serif;
	text-anchor: middle;
}

</style>
<svg width="650" height="650"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var circleColors = ["darkblue",
					"blue",
					"seagreen",
					"Turquoise",
					"SpringGreen",
					"greenyellow",
					"yellow",
					"orange",
					"orangered",
					"red"];
var svg = d3.select("svg");
var width = +svg.attr("width");
var heatMapWidth = width - 100;
var height = +svg.attr("height");
var circlePadding = 5;
var circleRadius = 25;
var x = 0;
var xIndex = 0;
var y = 0;
var yIndex = 0;
svg.append("rect")
.attr("x", 0)
.attr("width", heatMapWidth)
.attr("y", 0)
.attr("height", heatMapWidth)
.style("fill", "black")
.style("fill-opacity", .25)
var maxColor = -Infinity;
var minColor = Infinity;
d3.csv("heatmap.csv", function(d) {
	d.value = +d.value;
	if (d.value > 1)
	{
		if (d.value < minColor)
		{
			minColor = d.value;
		}
		if (d.value > maxColor)
		{
			maxColor = d.value;
		}
		return d;
	}
}, function(error, classes)
	{
		if (error)
		{
			throw error;
	 	}
		circleRadius = heatMapWidth / Math.sqrt(classes.length) - circlePadding;
		console.log(classes.length);
		console.log(circleRadius);
		for(i = 0; i < classes.length; i++)
		{
			var number = 10;
			svg.append("rect")
			.classed("circleBubble", true)
			.attr("value", classes[i]["value"])
			.attr("x", x)
			.attr("y", y)
			.attr("height", circleRadius)
			.attr("width", circleRadius)
			.attr("fill-opacity", 1)
			.attr("stroke-opacity", 0)
			.style("stroke", "black")
			.style("fill", function() { return grabColor(classes[i]["value"], circleColors); })
			.on("mouseover", function(d) {
				d3.select(this).attr('width', circleRadius + circlePadding);
				d3.select(this).attr('height', circleRadius + circlePadding);
				d3.select(this).attr("stroke-opacity", 1);
				d3.select(this).attr('x', function ()
				{
					var x = parseFloat(d3.select(this).attr('x'));
					return (x - circlePadding/2);
				})
				.attr('y', function ()
				{
					var y = parseFloat(d3.select(this).attr('y'));
					return (y - circlePadding/2);
				})
			})
			.on("mouseout", function(d) {
				d3.select(this).attr('width', circleRadius);
				d3.select(this).attr('height', circleRadius);
				d3.select(this).attr("stroke-opacity", 0);
				d3.select(this).attr('x', function ()
				{
					var x = parseFloat(d3.select(this).attr('x'));
					return (x + circlePadding/2);
				})
				.attr('y', function ()
				{
					var y = parseFloat(d3.select(this).attr('y'));
					return (y + circlePadding/2);
				})
			})
			.on("click", function(d)
			{
				toggleVisibility(this);

			});

			x += circleRadius + circlePadding;
			xIndex += 1;
			if (x > heatMapWidth)
			{
				x = 0;
				y += circleRadius + circlePadding;
				xIndex = 0;
				yIndex += 1;
			}
		}
		function grabColor(number, colors)
		{
			var divideColor = d3.scaleLinear().domain([minColor, maxColor]).range([0, 1]);
			var pickColor = d3.scaleLinear().domain([0, .1, .2, .3, .4, .5, .6, .7, .8, .9]).range(colors);
			var color = divideColor(number);
			return pickColor(color);
		}
		function toggleVisibility(objName)
		{
			var opacity = d3.select(objName).attr('fill-opacity');
			if (opacity == 0)
			{
				d3.select(objName).attr('fill-opacity', 1);
			}
			else if (opacity == 1)
			{
				d3.select(objName).attr('fill-opacity', 0);
			}
		}
	});


</script>
