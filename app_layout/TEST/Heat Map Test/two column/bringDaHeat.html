<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
	font: 10px sans-serif;
	text-anchor: middle;
}

</style>
<svg width="1200" height="1000"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var circleColors = ["darkblue", "blue", "seagreen", "Turquoise", "SpringGreen", "greenyellow", "yellow", "orange", "orangered", "red"];
var textColors = ["white", "white", "black", "black", "black", "black", "black", "black", "black", "red"];
var distro = ["0 - 10", "10 - 20", "20 - 30", "30 - 40", "40 - 50", "50 - 60", "60 - 70", "70 - 80", "80 - 90", "90 - 100"];
var svg = d3.select("svg");
var width = +svg.attr("width");
var height = +svg.attr("height");
var bubblePadding = 2.5;
var format = d3.format(",d");
var legendTileSize = 50;

var legendXTextPadding = -5; // Negative shifts text to the left.
function createColorLegend()
{
	for(i = 0; i < circleColors.length; i++)
	{
		var offset = 20;
		// Colored rectangles for legend
		svg.append("rect")
		.attr("x", width - legendTileSize)
		.attr("y", legendTileSize * i)
		.attr("width", legendTileSize)
		.attr("height", legendTileSize)
		.style("fill", circleColors[i])
		// Text labels for the colored rectangles.
		svg.append("text")
		.attr("x", width - legendTileSize + legendXTextPadding)
		.attr("y", (legendTileSize * i) + legendTileSize/2)
		.attr("dy", ".5em")
		.attr("width", legendTileSize)
		.attr("height", legendTileSize)
		.style("text-anchor", "end")
		.text(distro[i]);
	}
}
createColorLegend();
function createInfoLegend()
{
	svg.append("rect")
		.attr("x", width*.05)
		.attr("y", height * .8)
		.attr("width", width*.95)
		.attr("height", height * .2)
		.style("fill", "orange")
		.style("stroke", "black")
		.style("stroke-width", 1)

	objectName = svg.append("text")
	.attr("x", width*.475)
	.attr("y", height * .9)
	.attr("width", legendTileSize)
	.attr("height", legendTileSize)
	.style("text-anchor", "middle")
	.style("font-size", "40px")
	.text("test");
	objectValue = svg.append("text")
	.attr("x", width*.475)
	.attr("y", height * .975)
	.attr("width", legendTileSize)
	.attr("height", legendTileSize)
	.style("text-anchor", "middle")
	.style("font-size", "40px")
	.text("test");

}
createInfoLegend();
function grabTextColor(number, min, max)
{
	var divideColor = d3.scaleLinear().domain([min, max]).range([0, 1]);
	var pickColor = d3.scaleLinear().domain([0, .1, .2, .3, .4, .5, .6, .7, .8, .9]).range(textColors);
	var color = divideColor(number);
	return pickColor(color);
}
function grabCicleColor(number, min, max)
{
	var divideColor = d3.scaleLinear().domain([min, max]).range([0, 1]);
	var pickColor = d3.scaleLinear().domain([0, .1, .2, .3, .4, .5, .6, .7, .8, .9]).range(circleColors);
	var color = divideColor(number);
	return pickColor(color);
}
var pack = d3.pack()
.size([width, height*.8])
.padding(bubblePadding);
var maxColor = 0;
var minColor = 9999999999999;
d3.csv("flare.csv", function(d) {
	d.value = +d.value;
	if (d.value > 1)
	{
		if (d.value < minColor)
		{
			minColor = d.value;
		}
		if (d.value > maxColor)
		{
			maxColor = d.value;
		}
		return d;
	}
}, function(error, classes)
	{
		if (error)
		{
			throw error;
	 	}

		var root = d3.hierarchy({children: classes})
		.sum(function(d) { return d.value; })
		.each(function(d) {
			if (id = d.data.id) {
				var id, i = id.lastIndexOf(".");
				d.id = id;
				d.package = id.slice(0, i);
				d.class = id.slice(i + 1);
			}
		});

		var node = svg.selectAll(".node")
		.data(pack(root).leaves())
		.enter().append("g")
		.attr("class", "node")
		.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

		node.append("circle")
		.attr("id", function(d) { return d.id; })
		.attr("r", function(d) { return d.r; })
		.style("fill", function(d) { return grabCicleColor(d.value, minColor, maxColor); })
		.on("click", function(d) {
			objectName.text(d.id);
			objectValue.text(d.value);
		});

		node.append("clipPath")
		.attr("id", function(d) { return "clip-" + d.id; })
		.append("use")
		.attr("xlink:href", function(d) { return "#" + d.id; });

		node.append("text")
		.on("click", function(d) {
			objectName.text(d.id);
			objectValue.text(d.value);
		})
		.style("fill", function(d) { return grabTextColor(d.value, minColor, maxColor); })
		.attr("clip-path", function(d) { return "url(#clip-" + d.id + ")"; })
		.selectAll("tspan")
		.data(function(d) { return d.class.split(/(?=[A-Z][^A-Z])/g); })
		.enter().append("tspan")
		.attr("x", 0)
		.attr("y", function(d, i, nodes) { return 13 + (i - nodes.length / 2 - 0.5) * 10; })

		.text(function(d) { return d; });

		node.append("title")
		.text(function(d) { return d.id + "\n" + format(d.value); });
	});
</script>
