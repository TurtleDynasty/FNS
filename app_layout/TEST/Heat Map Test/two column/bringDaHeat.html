<!DOCTYPE html>
<meta charset="utf-8">
<style>

text {
	font: 10px sans-serif;
	text-anchor: middle;
}

</style>
<svg width="1000" height="1000"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
var colors = ["darkblue", "blue", "seagreen", "Turquoise", "SpringGreen", "greenyellow", "yellow", "orange", "orangered", "red"];

var distro = ["0 - 10", "10 - 20", "20 - 30", "30 - 40", "40 - 50", "50 - 60", "60 - 70", "70 - 80", "80 - 90", "90 - 100"];
var svg = d3.select("svg");
var width = +svg.attr("width");
var height = +svg.attr("height");
var bubblePadding = 1;
var format = d3.format(",d");
var legendTileSize = 18;
var legendXTextPadding = -5; // Negative shifts text to the left.
function createLegend()
{
	var legend = svg.selectAll(".legend")
        .data(colors)
      .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

	var index = -1;
    legend.append("rect")
        .attr("x", width - legendTileSize)
        .attr("width", legendTileSize)
        .attr("height", legendTileSize)
        .style("fill",  function(d) { index += 1; return colors[index];});
	var index = -1;
    legend.append("text")
        .attr("x", width - legendTileSize + legendXTextPadding)
        .attr("y", 9)
        .attr("dy", ".35em")
        .style("text-anchor", "end")
        .text(function(d) { index += 1; return distro[index]; });

}
createLegend();
function grabColor(number, min, max)
{
	var divideColor = d3.scaleLinear().domain([min, max]).range([0, 1]);
	var pickColor = d3.scaleLinear().domain([0, .1, .2, .3, .4, .5, .6, .7, .8, .9]).range(colors);
	var color = divideColor(number);
	return pickColor(color);
}
var pack = d3.pack()
.size([width, height*.8])
.padding(bubblePadding);
var maxColor = 0;
var minColor = 9999999999999;
d3.csv("flare.csv", function(d) {
	d.value = +d.value;
	if (d.value > 1)
	{
		if (d.value < minColor)
		{
			minColor = d.value;
		}
		if (d.value > maxColor)
		{
			maxColor = d.value;
		}
		return d;
	}
}, function(error, classes)
	{
		if (error)
		{
			throw error;
	 	}

		var root = d3.hierarchy({children: classes})
		.sum(function(d) { return d.value; })
		.each(function(d) {
			if (id = d.data.id) {
				var id, i = id.lastIndexOf(".");
				d.id = id;
				d.package = id.slice(0, i);
				d.class = id.slice(i + 1);
			}
		});

		var node = svg.selectAll(".node")
		.data(pack(root).leaves())
		.enter().append("g")
		.attr("class", "node")
		.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

		node.append("circle")
		.attr("id", function(d) { return d.id; })
		.attr("r", function(d) { return d.r; })
		.style("fill", function(d) { return grabColor(d.value, minColor, maxColor); });

		node.append("clipPath")
		.attr("id", function(d) { return "clip-" + d.id; })
		.append("use")
		.attr("xlink:href", function(d) { return "#" + d.id; });

		node.append("text")
		.attr("clip-path", function(d) { return "url(#clip-" + d.id + ")"; })
		.selectAll("tspan")
		.data(function(d) { return d.class.split(/(?=[A-Z][^A-Z])/g); })
		.enter().append("tspan")
		.attr("x", 0)
		.attr("y", function(d, i, nodes) { return 13 + (i - nodes.length / 2 - 0.5) * 10; })
		.text(function(d) { return d; });

		node.append("title")
		.text(function(d) { return d.id + "\n" + format(d.value); });
	});
</script>
